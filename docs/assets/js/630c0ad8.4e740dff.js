"use strict";(self.webpackChunkliveviewjs_com=self.webpackChunkliveviewjs_com||[]).push([[7911],{876:(e,t,i)=>{i.d(t,{Zo:()=>h,kt:()=>u});var a=i(2784);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=a.createContext({}),c=function(e){var t=a.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):s(s({},t),e)),i},h=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),p=c(i),u=n,v=p["".concat(l,".").concat(u)]||p[u]||d[u]||r;return i?a.createElement(v,s(s({ref:t},h),{},{components:i})):a.createElement(v,s({ref:t},h))}));function u(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,s=new Array(r);s[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:n,s[1]=o;for(var c=2;c<r;c++)s[c]=i[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,i)}p.displayName="MDXCreateElement"},1217:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=i(7896),n=(i(2784),i(876));const r={sidebar_position:1},s="Lifecycle of a LiveView",o={unversionedId:"lifecycle-of-a-liveview/intro",id:"lifecycle-of-a-liveview/intro",title:"Lifecycle of a LiveView",description:"We are going to look at the lifecycle of LiveViews in detail to see when each LiveView method (e.g. mount, handleEvent, render, etc) are called during the lifecycle so you can better understand how to use them.",source:"@site/docs/05-lifecycle-of-a-liveview/intro.md",sourceDirName:"05-lifecycle-of-a-liveview",slug:"/lifecycle-of-a-liveview/intro",permalink:"/docs/lifecycle-of-a-liveview/intro",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Lifecycle of a LiveView",permalink:"/docs/category/lifecycle-of-a-liveview"},next:{title:"User Events",permalink:"/docs/category/user-events"}},l={},c=[{value:"HTTP and Websocket",id:"http-and-websocket",level:2},{value:"HTTP Request Phase",id:"http-request-phase",level:3},{value:"Advantages of HTML",id:"advantages-of-html",level:4},{value:"Websocket Phase",id:"websocket-phase",level:3},{value:"Websocket Join Phase",id:"websocket-join-phase",level:4},{value:"Interactive Phase",id:"interactive-phase",level:4},{value:"Other Processes / Phases",id:"other-processes--phases",level:3},{value:"Heartbeat",id:"heartbeat",level:4},{value:"Shutdown",id:"shutdown",level:4}],h={toc:c};function d(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},h,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"lifecycle-of-a-liveview"},"Lifecycle of a LiveView"),(0,n.kt)("p",null,"We are going to look at the lifecycle of LiveViews in detail to see when each LiveView method (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"mount"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"handleEvent"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"render"),", etc) are called during the lifecycle so you can better understand how to use them."),(0,n.kt)("h2",{id:"http-and-websocket"},"HTTP and Websocket"),(0,n.kt)("p",null,"There are two major parts of a lifecycle:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"HTTP request phase"),(0,n.kt)("li",{parentName:"ol"},"Websocket phase")),(0,n.kt)("h3",{id:"http-request-phase"},"HTTP Request Phase"),(0,n.kt)("p",null,"Just like any other web page, all LiveViews start with a HTTP request to a URL (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"GET /my-liveview"),") and this route is served by a webserver (e.g. Express). If that route is a LiveView route, the webserver hands off the request to the ",(0,n.kt)("strong",{parentName:"p"},"LiveViewJS")," library for processing.  "),(0,n.kt)("p",null,"The ",(0,n.kt)("strong",{parentName:"p"},"LiveViewJS")," library then creates a new LiveView instance and starts the HTTP request phase which consists of:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"mount")," - The LiveView is mounted and the context is initialized"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"handleParams")," - The LiveView is given a chance to handle any params passed in the URL (e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"GET /my-liveview?foo=bar"),")"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"render")," - The LiveView is rendered based on the ",(0,n.kt)("inlineCode",{parentName:"li"},"context")," and the HTML is returned to the webserver ")),(0,n.kt)("p",null,"The webserver then returns the HTML to the browser.  Below is a sequence diagram showing the HTTP request phase:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Http Request Phase",src:i(9581).Z,width:"1302",height:"1093"})),(0,n.kt)("h4",{id:"advantages-of-html"},"Advantages of HTML"),(0,n.kt)("p",null,"The advantage of rendering the HTML initially is:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},'"First paint" is extremely fast (it\'s just HTML)'),(0,n.kt)("li",{parentName:"ul"},"No waiting for MBs of JS to download"),(0,n.kt)("li",{parentName:"ul"},"Renders even if JS is disabled"),(0,n.kt)("li",{parentName:"ul"},"Search engine friendly (again it is only HTML)")),(0,n.kt)("h3",{id:"websocket-phase"},"Websocket Phase"),(0,n.kt)("p",null,"After the initial HTTP request and response, the LiveView client javascript automatically connects to the LiveView server via a websocket.  The websocket is used to send events from the browser to the LiveView server and to receive DOM patches from the LiveView server.  The websocket phase breaks down into three parts:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},'"Websocket Join" - Establish the websocket connection and run the initial LiveView lifecycle methods'),(0,n.kt)("li",{parentName:"ol"},'"Interactive" - The LiveView is interactive and can respond to user events or update based on server events'),(0,n.kt)("li",{parentName:"ol"},'"Shutdown" - The LiveView automatically cleans up and shuts down resources')),(0,n.kt)("h4",{id:"websocket-join-phase"},"Websocket Join Phase"),(0,n.kt)("p",null,'During the "Websocket Join" phase the LiveView runs the same initiliation methods as the HTTP request phase:'),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"mount")," - The LiveView is mounted and the context is initialized"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"handleParams")," - The LiveView is given a chance to handle any params passed in the URL (e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"GET /my-liveview?foo=bar"),")"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("inlineCode",{parentName:"li"},"render")," - The LiveView is rendered based on the ",(0,n.kt)("inlineCode",{parentName:"li"},"context"))),(0,n.kt)("p",null,'But instead of sending back a full HTML page, the LiveView sends back a datastructure that breaks down the HTML into "static" and "dynamic" parts. This data structure allows future "diffs" to be sent to the client to update the DOM.  Below is a sequence diagram showing the "Websocket Join" phase:'),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Websocket Join",src:i(7563).Z,width:"1277",height:"990"})),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"  You may have noticed both the HTTP request phase and the Websocket Join phase run the same methods.  This is because the LiveView is initialized (",(0,n.kt)("inlineCode",{parentName:"p"},"mount")," => ",(0,n.kt)("inlineCode",{parentName:"p"},"handleParams")," => ",(0,n.kt)("inlineCode",{parentName:"p"},"render"),") in both phases.  The HTTP phase doesn't retain any state but the Websocket phase does keep state in memory so needs to re-run the initialization methods. Importantly, you may also want to handle HTTP vs Websocket differently in your LiveView so calling the initialization methods in both phases is important.")),(0,n.kt)("h4",{id:"interactive-phase"},"Interactive Phase"),(0,n.kt)("p",null,'Once the Websocket has been established, the LiveView is in the "Interactive" phase.  In this phase the LiveView can respond to user events and server events.  '),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"User events")," (clicks, form updates/submissions, keyboard input, etc) are sent from the browser to the LiveView server via the websocket, routed to ",(0,n.kt)("inlineCode",{parentName:"p"},"handleEvent")," then ",(0,n.kt)("inlineCode",{parentName:"p"},"render"),".  ",(0,n.kt)("strong",{parentName:"p"},"LiveViewJS"),' then calculates the "diffs", sends those diffs back to the client which automatically applies them to the DOM.'),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Server events")," (from ",(0,n.kt)("inlineCode",{parentName:"p"},"socket.sendInfo")," or Pub/Sub subscriptions) are automatically received in the LiveView server, routed to ",(0,n.kt)("inlineCode",{parentName:"p"},"handleInfo")," then to ",(0,n.kt)("inlineCode",{parentName:"p"},"render"),"  Similar to user events, ",(0,n.kt)("strong",{parentName:"p"},"LiveViewJS"),' then calculates the "diffs", sends those diffs back to the client which automatically applies them to the DOM.'),(0,n.kt)("p",null,'Below is a sequence diagram showing the "Interactive" phase:'),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Interactive",src:i(7153).Z,width:"1285",height:"1814"})),(0,n.kt)("h3",{id:"other-processes--phases"},"Other Processes / Phases"),(0,n.kt)("p",null,"LiveViews have a couple of other processes that are important to understand but are automatically handled by ",(0,n.kt)("strong",{parentName:"p"},"LiveViewJS")," so you don't need to worry about them."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},'"Heartbeat" - The LiveView clientr sends a heartbeat message to the server every 30 seconds to ensure the websocket connection is still alive'),(0,n.kt)("li",{parentName:"ol"},'"Shutdown" - The LiveView automatically cleans up and shuts down resources')),(0,n.kt)("p",null,'Here are a couple of sequence diagrams showing the "Heartbeat" and "Shutdown" phases:'),(0,n.kt)("h4",{id:"heartbeat"},"Heartbeat"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Heartbeat",src:i(3545).Z,width:"852",height:"628"})),(0,n.kt)("h4",{id:"shutdown"},"Shutdown"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Shutdown",src:i(3430).Z,width:"845",height:"816"})))}d.isMDXComponent=!0},3545:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/liveview-lifecycle-heartbeat-65d664e1b997bbc0737aee2d81e0575e.svg"},9581:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/liveview-lifecycle-http-phase-ea214711543a70a25c10e3bf28ab347b.svg"},3430:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/liveview-lifecycle-shutdown-7e64e2d957894e06dadbde8ebfce6dc0.svg"},7153:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/liveview-lifecycle-user-and-server-events-0c078ec9c402dedb80571d075a41922e.svg"},7563:(e,t,i)=>{i.d(t,{Z:()=>a});const a=i.p+"assets/images/liveview-lifecycle-websocket-join-a167e1df602ab471b5bba9187ccf6ae2.svg"}}]);